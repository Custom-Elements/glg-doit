<link rel="import" href="../node_modules/ui-typeahead/src/ui-typeahead.html">
<link rel="import" href="../node_modules/ui-check/src/ui-check.html">
<link rel="import" href="../node_modules/ui-input/src/ui-input.html">
<link rel="import" href="../node_modules/ui-form/src/ui-form.html">
<link rel="import" href="../node_modules/ui-avatar/src/ui-avatar.html">
<link rel="import" href="../node_modules/ui-markdown/src/ui-markdown.html">
<link rel="import" href="../node_modules/ui-preview/src/ui-preview.html">
<link rel="import" href="../lib/core-ajax.html">
<polymer-element name="glg-task" attributes="task coworkers">
<template>
  <core-ajax
    id="coworkers"
    auto
    method="POST"
    url="https://services.glgresearch.com/cerca/employees/_search"
    body='{"query":{"match":{"name":"balla"}}}'
    handleAs="json"
    withCredentials=true
    on-core-response="{{coworkersResponse}}"></core-ajax>
  <link rel="stylesheet" href="../node_modules/ui-fonts/node_modules/ui-font-awesome/icons.less">
  <link rel="stylesheet" type="text/css" href="./glg-task.less">
  <ui-preview>
    <preview>
      <ui-form>
        <section horizontal layout>
          <icon complete><ui-check value="{{task.complete}}" on-change="{{completeChange}}"></ui-check></icon>
          <ui-markdown value="{{task.what}}">
          </ui-markdown>
        </section>
        <small horizontal spaced layout>
          <template repeat="{{task.who}}">
            <ui-avatar name="{{name}}"></ui-avatar>
          </template>
          {{task.when | relativeDate}}
        </small>
      </ui-form>
    </preview>
    <full>
      <ui-form>
        <ui-input multiline="2" value="{{task.what}}">
          <preview>
            <ui-markdown value="{{task.what}}">
            </ui-markdown>
          </preview>
          <icon complete><ui-check value="{{task.complete}}" on-change="{{completeChange}}"></ui-check></icon>
        </ui-input>
        <ui-input placeholder="When?" type="date" value="{{task.when}}">
          <preview>{{task.when | relativeDate}}</preview>
          <icon calendar></icon>
        </ui-input>
        <ui-typeahead id="multiple" placeholder="Who?" multiselect value="{{task.who}}" on-inputchange="{{searchCoworkers}}">
          <icon user></icon>
          <template value>
            <value><ui-avatar name="{{name}}"></ui-avatar></value>
          </template>
          <template repeat="{{coworkers}}">
            <ui-typeahead-item>
              <ui-avatar name="{{name}}"></ui-avatar>
              <span>{{name}}</span>
            </ui-typeahead-item>
          </template>
        </ui-typeahead>
      </ui-form>
    </full>
  </ui-preview>
</template>
<script src="./glg-task.litcoffee"></script>
</polymer-element>
